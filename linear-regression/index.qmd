---
title: <span style="color:white">Linear Regression Playbook</span>
subtitle: "A reference guide for future me and others who need it"

author: 
- name: "Matthew Kuch"
  email: kuch.matthew@gmail.com
date: 11/06/2025

title-block-banner: true
title-block-banner-color: "black"

format: html
html:
code-fold: false
code-summary: "Code"
echo: true
css: style.css
toc: true
toc-location: left
number-sections: false
editor: visual
fig-cap-location: margin
---

```{r message=FALSE, warning=FALSE}

# First we load the libraries and data
library(tidyverse)     # This lets you create plots with ggplot, manipulate data, etc.
library(broom)         # This lets you convert regression models into nice tables
library(modelsummary)  # This lets you combine multiple regression models into a single table

# Load the data. 
# It'd be a good idea to click on the "sat_gpa" object in the Environment panel
# in RStudio to see what the data looks like after you load it.
sat_gpa <- read_csv("input/sat_gpa.csv")



```

# Introduction

Using SAT and GPA data from Dartmouth College (["Chance" Course](https://chance.dartmouth.edu/course/Syllabi/Princeton96/Class12.html)) , the goal is to conduct some statistical analysis on this data to answer the questions listed in the sections below:

This is actually a form of People Analytics using Student Past Performance (e.g. SAT Grades) to Predict Future Performance.

Let's say you are a university admissions officer and you are curious if SAT scores really do predict college performance. You’re also interested in other factors that could influence student performance.

The data contains 6 variables:

-   `sex`: The sex of the student (male or female; female is the base case)

-   `sat_verbal`: The student’s *percentile* score in the verbal section of the SAT

-   `sat_math`: The student’s *percentile* score in the math section of the SAT

-   `sat_total`: `sat_verbal` + `sat_math`

-   `gpa_hs`: The student’s GPA in high school at graduation

-   `gpa_fy`: The student’s GPA at the end of their freshman year

### Correlations (Exploratory Questions)

#### **1. How well do SAT scores correlate with freshman GPA?**

##### 1.1 Using the Correlation Function

```{r}
cor(sat_gpa$sat_total,sat_gpa$gpa_fy)
```

##### 1.2 Drawing a scatterplot of the relationship using ggplot

```{r}
ggplot(data = sat_gpa, mapping = aes(x=sat_total, y=gpa_fy)) +
  geom_point() +
  geom_smooth(method = "lm") + 
  labs(x="Total SAT Score", y="Freshman GPA")
```

...

#### **2. How well does high school GPA correlate with freshman GPA?**

##### 2.1 Using the Correlation Function

```{r}
cor(sat_gpa$gpa_hs,sat_gpa$gpa_fy)
```

##### 2.2 Drawing a scatterplot of the relationship using ggplot

```{r}
ggplot(data = sat_gpa, mapping = aes(x=gpa_hs, y=gpa_fy)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x="Highschool GPA", y="Freshman GPA")
```

...

#### **3A. Is the correlation between SAT scores and freshman GPA stronger for men or for women?**

```{r}
sat_gpa |> 
  group_by(sex) |> 
  summarise(correlation = cor(sat_total,gpa_fy))
```

#### **3B. Is the correlation between HighSchool GPA and freshman GPA stronger for men or for women?**

```{r}
sat_gpa |> 
  group_by(sex) |> 
  summarise(correlation = cor(gpa_hs,gpa_fy))
```

```{r}
ggplot(data = sat_gpa, mapping = aes(x=gpa_hs, y=gpa_fy, color=sex)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x="Highschool GPA", y="Freshman GPA")
```

....

### Predictive Models

#### **4. Do SAT scores predict freshman GPAs?**

A reminder of the formula we'll be replicating when doing linear regression i.e. Y = mX + b, where:

-   Y - the outcome variable

-   X - in the explanatory variable

-   m - is the slope (rise over run)

-   b - is the Y-intercept

For this particular case, it can be represented by the formula below:

![](assets/linear-regression-equation.png){fig-align="center"}

-   Where the "E" looking symbol at the end represents the standard error

The R-code to implement this, is below:

```{r}
model_sat_gpa <- lm(gpa_fy ~ sat_total, data = sat_gpa) # You can read this as Freshman gpa "is explained by" / "~" SAT scores

# Look at the model results and include confidence intervals for the coefficients
tidy(model_sat_gpa, conf.int = TRUE)
```

Here’s what these coefficients mean:

-   The Y-intercept (Beta-0) is 0.002, which means that the average freshman GPA will be 0.002 when the total SAT percentile score is 0. This is a pretty nonsensical number (nobody has a score that low), so we can ignore it.

-   The slope of `sat_total` (Beta-1) is 0.024, which means that a 1 percentile increase in SAT score is associated with a 0.024 point increase in GPA, on average. Rise over Run i.e. 1% rise, 0.024 run.

We can look at the summary table of the regression to check the R-squared (R\^2) :

```{r}
glance(model_sat_gpa)
```

The R-squared here is 0.212, which means that SAT scores explain 21% of the variation in freshman GPA. It’s not a fantastic model, but it explains some stuff.

...

#### **5. Does a certain type of SAT score have a larger effect on freshman GPAs?**

The 2 types of SAT scores are:

-   SAT Verbal, and

-   SAT Math

This particular case, can be represented by the formula below:

![](assets/multi-variate-linear-regression.png)

Implementing this in R:

```{r}
model_sat_gpa_types <- lm(gpa_fy ~ sat_verbal + sat_math, data = sat_gpa)

tidy(model_sat_gpa_types, conf.int = TRUE)
```

-   Again, the intercept is meaningless since no student has a zero on both the verbal and the math test.

-   The slope for `sat_verbal` (or Beta-1) is 0.025, so a one percentile point increase in the verbal SAT is associated with a 0.025 point increase in GPA, on average, controlling for math scores

-   Meanwhile, a one percentile point increase in the math SAT () is associated with a 0.022 point increase in GPA, on average, controlling for verbal scores.

These are essentially the same, so at first glance, it doesn’t seem like the type of test has substantial bearing on college GPAs.

**Checking the Adjusted R-squared:**

```{r}
glance(model_sat_gpa_types)
```

The adjusted R-squared (which we need to look at because we’re using more than one explanatory variable) is 0.211, which means that this model explains 21% of the variation in college GPA. Like before, this isn’t great, but it tells us a little bit about the importance of SAT scores.

...

#### **6A. Do high school GPAs predict freshman GPAs?**

Similar to the above in approach, but now the formula is:

![](assets/linear-regression-equation-hs-fy-gpa.png)

And implementing the model in R is as follows:

```{r}
model_sat_gpa_hs <- lm(gpa_fy ~ gpa_hs, data = sat_gpa)

tidy(model_sat_gpa_hs)
```

-   The intercept here (Beta-0) is 0.091, which means that a student with a high school GPA of zero would have a predicted freshman GPA of 0.091, on average. This is nonsensical, so we can ignore it.

-   The slope for `gpa_hs` (Beta-1), on the other hand, is helpful. For every 1 point increase in GPA (i.e. moving from 2.0 to 3.0, or 3.0 to 4.0), there’s an associated increase in college GPA of 0.743 points, on average.

**Checking the R-squared, for this model:**

```{r}
glance(model_sat_gpa_hs)
```

-   The R-squared value is 0.295, which means that nearly 30% of the variation in college GPA can be explained by high school GPA. Neat.

#### 6B. College GPA \~ SAT + sex

Next, we can see how both SAT scores and sex affect variation in college GPA with the following model:

![](assets/linear-regression-equation-gpa-sat-sex.png)

Implementation in R:

```{r}
model_sat_sex <- lm(gpa_fy ~ sat_total + sex, data = sat_gpa)

tidy(model_sat_sex, conf.int = TRUE)
```

-   Here, stuff gets interesting. The intercept (Beta-0) is once again nonsensical—females with a 0 score on their SAT would have a -0.027 college GPA on average.

-   There’s a positive effect with our Beta-1 (or `sat_total`), since controlling for sex, a one percentile point increase in SAT scores is associated with a 0.026 point increase in freshman GPA, on average.

-   If we control for SAT scores, males see an average drop of 0.274 points (Beta-2) in their college GPAs.

-   The combination of these two variables, however, doesn’t boost the model’s explanatory power that much.

**Adjusted R-squared:**

```{r}
glance(model_sat_sex)
```

-   The adjusted R-squared (which we must look at because we’re using more than one explanatory variable) is 0.243, meaning that the model explains a little over 24% of the variation in college GPAs.

#### **6C. College GPA \~ SAT + high school GPA + sex**

Finally we can see what the effect of SAT scores, high school GPA, and sex is on college GPAs all at the same time, using the following model:

![](assets/linear-regression-equation-gpa-sat-hs-gpa-sex.png)

Implementation in R:

```{r}
model_sat_hs_sex <- lm(gpa_fy ~ sat_total + gpa_hs + sex, data = sat_gpa)

tidy(model_sat_hs_sex, conf.int = TRUE)
```

-   Yet again, the intercept (Beta-0) can be safely ignored. Here it means that a female with a 0.0 high school GPA and an SAT score of 0 would have a college GPA of -0.84, on average. That’s pretty impossible.

-   The Beta-1 coefficient for `sat_total` indicates that taking into account high school GPA and sex, a one percentile point increase in a student’s SAT score is associated with a 0.016 point increase in their college GPA, on average.

-   Controlling for SAT scores and sex, a one point increase in high school GPA is associated with a 0.545 point (this is Beta-2) increase in college GPA, on average. This coefficient is lower than the 0.74 point coefficient we found previously. That’s because SAT scores and sex soaked up some of high school GPA’s explanatory power.

-   Taking SAT scores and high school GPAs into account, males have a 0.143 point lower GPA in college, on average (this is Beta-3 )

**Adjusted R-squared:**

```{r}
glance(model_sat_hs_sex)
```

-   As always, the adjusted  shows us how well the model fits overall (again, we have to look at the adjusted  because we have more than one explanatory variable). In this case, the model explains 36.5% of the variation in college GPA, which is higher than any of the previous models (but not phenomenal, in the end).

...

#### **7. Which model best predicts freshman GPA? How do you know?**

As you’ve learned in previous stats classes, adjusted  generally shows the strength of a model’s fit, or how well the model will predict future values of the outcome variable. If we compare the adjusted  for each of the models, we see that the “best” model is the last one.

```{r}
# The modelsummary() function takes a bunch of different regression models and
# puts them in a neat side-by-side table. In a normal report or analysis, you'd
# include all of these once instead of going one by one like we did above.

modelsummary(list(model_sat_gpa, model_sat_gpa_types, model_sat_gpa_hs, 
                  model_sat_sex, model_sat_hs_sex))
```

...

# Notes and References:

-   <https://evalf20.classes.andrewheiss.com/example/regression/>

-   <https://youtu.be/E-Zz5S5NOUo>

-   <https://chance.dartmouth.edu/course/Syllabi/Princeton96/Class12.html>

-   <https://chance.dartmouth.edu/course/Syllabi/Princeton96/princeton96.html>

-   <https://chance.dartmouth.edu/>
