<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Kuch">
<meta name="dcterms.date" content="2025-11-09">

<title>Bayesian Statistics Playbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: black;
      }

      .quarto-title-block .quarto-title-banner {
        color: black;
      }
</style>


<link rel="stylesheet" href="style.css">
</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span style="color:white">Bayesian Statistics Playbook</span></h1>
            <p class="subtitle lead">A reference guide based on the book Statistical Rethinking by Richard McElreath</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Matthew Kuch <a href="mailto:kuch.matthew@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 9, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#the-tools" id="toc-the-tools" class="nav-link" data-scroll-target="#the-tools">The Tools</a></li>
  <li><a href="#the-recipe-approach-used---what-he-calls-the-bayesian-owl" id="toc-the-recipe-approach-used---what-he-calls-the-bayesian-owl" class="nav-link" data-scroll-target="#the-recipe-approach-used---what-he-calls-the-bayesian-owl">The Recipe / Approach used - what he calls the ‚ÄúBayesian Owl‚Äù</a></li>
  </ul></li>
  <li><a href="#chapter-1---the-golem-of-prague" id="toc-chapter-1---the-golem-of-prague" class="nav-link" data-scroll-target="#chapter-1---the-golem-of-prague">Chapter 1 - The Golem of Prague</a>
  <ul class="collapse">
  <li><a href="#hypotheses-are-not-models" id="toc-hypotheses-are-not-models" class="nav-link" data-scroll-target="#hypotheses-are-not-models">Hypotheses are not models</a></li>
  <li><a href="#measurement-matters" id="toc-measurement-matters" class="nav-link" data-scroll-target="#measurement-matters">Measurement matters</a></li>
  <li><a href="#why-bayesian-data-analysis" id="toc-why-bayesian-data-analysis" class="nav-link" data-scroll-target="#why-bayesian-data-analysis">Why Bayesian Data Analysis ?</a></li>
  <li><a href="#bayesian-data-analysis-is-simply" id="toc-bayesian-data-analysis-is-simply" class="nav-link" data-scroll-target="#bayesian-data-analysis-is-simply">Bayesian Data Analysis is simply‚Ä¶</a></li>
  </ul></li>
  <li><a href="#chapter-2---small-worlds-and-large-worlds" id="toc-chapter-2---small-worlds-and-large-worlds" class="nav-link" data-scroll-target="#chapter-2---small-worlds-and-large-worlds">Chapter 2 - Small Worlds and Large Worlds</a>
  <ul class="collapse">
  <li><a href="#the-garden-of-forking-data---4-marbles-example" id="toc-the-garden-of-forking-data---4-marbles-example" class="nav-link" data-scroll-target="#the-garden-of-forking-data---4-marbles-example">2.1 The garden of forking data - 4 marbles example</a>
  <ul class="collapse">
  <li><a href="#counting-the-possibilities" id="toc-counting-the-possibilities" class="nav-link" data-scroll-target="#counting-the-possibilities">2.1.1 Counting the possibilities</a></li>
  <li><a href="#you-start-drawing-marbles" id="toc-you-start-drawing-marbles" class="nav-link" data-scroll-target="#you-start-drawing-marbles">You start drawing marbles</a></li>
  <li><a href="#every-new-draw-creates-a-fork" id="toc-every-new-draw-creates-a-fork" class="nav-link" data-scroll-target="#every-new-draw-creates-a-fork">Every new draw creates a fork</a></li>
  <li><a href="#lets-build-the-garden-of-forking-marbles-in-r" id="toc-lets-build-the-garden-of-forking-marbles-in-r" class="nav-link" data-scroll-target="#lets-build-the-garden-of-forking-marbles-in-r">Let‚Äôs build the garden of forking marbles in R</a></li>
  </ul></li>
  <li><a href="#building-a-model" id="toc-building-a-model" class="nav-link" data-scroll-target="#building-a-model">2.2 Building a model</a></li>
  <li><a href="#components-of-the-model" id="toc-components-of-the-model" class="nav-link" data-scroll-target="#components-of-the-model">2.3 Components of the model</a></li>
  <li><a href="#making-the-model-go" id="toc-making-the-model-go" class="nav-link" data-scroll-target="#making-the-model-go">2.4 Making the model go</a></li>
  </ul></li>
  <li><a href="#chapter-3---sampling-the-imaginary" id="toc-chapter-3---sampling-the-imaginary" class="nav-link" data-scroll-target="#chapter-3---sampling-the-imaginary">Chapter 3 - Sampling the Imaginary</a></li>
  <li><a href="#notes-and-references" id="toc-notes-and-references" class="nav-link" data-scroll-target="#notes-and-references">Notes and References:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we load the libraries and data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)     <span class="co"># This lets you create plots with ggplot, manipulate data, etc.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Great book about doing statistical casual inference using Bayesian data analysis and other related tools.</p>
<p>The author using interesting analogies and stories to explain complex ideas and concepts e.g.&nbsp;Golems (statistical models) and Garden of Forking Data (Counting possibilities)</p>
</section>
<section id="the-tools" class="level2">
<h2 class="anchored" data-anchor-id="the-tools">The Tools</h2>
<p>The tools for ‚ÄúGolem engineering‚Äù proposed in the book are: 1. Bayesian Data analysis 2. Model comparison 3. Multilevel models 4. Graphical casual models (aka DAGs - Directed Acyclic Graphs)</p>
</section>
<section id="the-recipe-approach-used---what-he-calls-the-bayesian-owl" class="level2">
<h2 class="anchored" data-anchor-id="the-recipe-approach-used---what-he-calls-the-bayesian-owl">The Recipe / Approach used - what he calls the ‚ÄúBayesian Owl‚Äù</h2>
<ol type="1">
<li><strong>Generate a Theoretical estimand (a testable hypothesis)</strong> - what are we even trying to achieve/do in this study / what question are we trying to answer</li>
<li><strong>Create a scientific theoretical casual model</strong> (starts out as a DAG and eventually needs to be a Generative casual model i.e.&nbsp;you can simulate data from the model)</li>
<li><strong>Use (1) and (2) to build statistical model(s)</strong> (aka build your ‚ÄòGolem(s)‚Äô)</li>
<li><strong>Create simulated data for (2) to validate (3) to yield (1)</strong> - This is like unit testing in software engineering or back-testing in Quantitative Finance</li>
<li>Analyze real world data</li>
</ol>
<p>‚Ä¶</p>
</section>
</section>
<section id="chapter-1---the-golem-of-prague" class="level1">
<h1>Chapter 1 - The Golem of Prague</h1>
<p>An introductory chapter that uses the metaphor of ‚ÄúThe Golem of Prague‚Äù to explain how statistical models can cause harm in the real world, hence we need to engineer them with best in class statistical practices and tools, to avoid mistakes.</p>
<p>This builds on his talk about ‚ÄúScience as Amateur Software Engineering‚Äù, available here: <a href="https://youtu.be/8qzVV7eEiaI" class="uri">https://youtu.be/8qzVV7eEiaI</a> - where he makes the case that too many research scientists treat their research like a hobby, and that actual professional standards are needed to avoid making research mistakes that create ‚ÄúGolems‚Äù that negatively impact the world.</p>
<section id="hypotheses-are-not-models" class="level3">
<h3 class="anchored" data-anchor-id="hypotheses-are-not-models">Hypotheses are not models</h3>
<p>He especially makes the case for statistical rethinking (section 1.2) because he believes that classical statistical inference methods (as taught in school and university) focuses too much on significance testing a model‚Äôs null-hypothesis, arguing that Karl Popper said that the goal of the scientific method is to find disconfirming evidence (i.e.&nbsp;falsification)</p>
<p><img src="assets/Statmodelstoday.png" class="img-fluid"></p>
<p>He argues that statistical procedures should falsify hypotheses not models because ‚ÄúHypotheses are not models‚Äù</p>
<p><img src="assets/StatsRethinking_Pg5.png" class="img-fluid"></p>
<p>Evidence &gt; Theory &gt; Models</p>
<p><img src="assets/Evidence%20greater%20than%20Theory%20greater%20than%20Models.png" class="img-fluid"></p>
</section>
<section id="measurement-matters" class="level3">
<h3 class="anchored" data-anchor-id="measurement-matters">Measurement matters</h3>
<p>He also makes the case the measurement error is very common in how statistics is practiced today because of the tendency to focus on falsifying models, and not the actual research hypothesis.</p>
<p><img src="assets/StatsRethinking_Pg8.png" class="img-fluid"></p>
</section>
<section id="why-bayesian-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="why-bayesian-data-analysis">Why Bayesian Data Analysis ?</h3>
<p>Richard argues that it addresses many of the issues related to measurement error and hypotheses being treated as models. However, the Bayesian approach is overkill for most simple analysis (kind of like using a Chainsaw to cut a cake) . Bayesian is best for relatively larger-scale analysis in scientific research, where measurement error, missing data, latent variables are rampant.</p>
<p><img src="assets/BayesIsPracticalNOTPhilosophical.png" class="img-fluid"></p>
</section>
<section id="bayesian-data-analysis-is-simply" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-data-analysis-is-simply">Bayesian Data Analysis is simply‚Ä¶</h3>
<p><img src="assets/BDA%20_simply.png" class="img-fluid"></p>
<p>‚Ä¶</p>
</section>
</section>
<section id="chapter-2---small-worlds-and-large-worlds" class="level1">
<h1>Chapter 2 - Small Worlds and Large Worlds</h1>
<p>This chapter starts with a nice historical analogy about how <a href="https://theoatmeal.com/comics/columbus_day">Christoper Columbus</a>‚Äô belief (prior) about the world was incorrect, which caused him to undertake a journey that changed history and resulted in the creation of America, as we know it today.</p>
<p>Columbus assumed/believed that the earth was only 30,000 kms round (the circumference), hence he thought we would have enough food rations and resources to sail to India from Europe.</p>
<p>The reality is that the world is 40,000km round, hence if he didnt find the land-mass of America on the way to India, he would have died - which many argue would have saved millions of native Americans. But unfortunately his mistake wasn‚Äôt costly and he ‚Äúdiscovered‚Äù America.</p>
<p>He had a small world view of the world, which was 10,000 kms less than the real and larger world. Columbus made a prediction based upon his view that the world was small. His story provides a clear contrast between the models we use and reality. The map versus the terrain.</p>
<p>In <strong>Chapter 2 of the book we begin to build Bayesian models</strong>. The way that Bayesian models learn from evidence is arguably optimal in the small world. When their assumptions approximate reality, they also perform well in the large world.</p>
<section id="the-garden-of-forking-data---4-marbles-example" class="level2">
<h2 class="anchored" data-anchor-id="the-garden-of-forking-data---4-marbles-example">2.1 The garden of forking data - 4 marbles example</h2>
<p>To better understand the thinking around building bayesian models, the 1st example looks at guessing the color of marbles inside a bag, based on evidence (randomly drawing 1 marble at at time, with replacement).</p>
<section id="counting-the-possibilities" class="level3">
<h3 class="anchored" data-anchor-id="counting-the-possibilities">2.1.1 Counting the possibilities</h3>
<p><strong>Situation:</strong> Imagine you have a small <strong>bag with 4 marbles</strong>.<br>
Each marble can be either <strong>blue</strong> ‚ö™ or <strong>white</strong> üîµ.</p>
<p><strong>Complication:</strong> But you don‚Äôt know how many of each color are inside.</p>
<p>All you can do is:<br>
üëâ pull out a marble (look at it), note the color, and then put it back.</p>
<p>That‚Äôs it.</p>
<p><strong>Question: What could be inside the bag?</strong></p>
<p><u><strong>Resolution / Answer / Approach</strong></u></p>
<p>There are <strong>5 possible worlds</strong> (different ‚Äúforks‚Äù in our garden):</p>
<p><img src="assets/possible_worlds_4_marbles.png" class="img-fluid"></p>
</section>
<section id="you-start-drawing-marbles" class="level3">
<h3 class="anchored" data-anchor-id="you-start-drawing-marbles">You start drawing marbles</h3>
<p>Let‚Äôs say you draw <strong>one marble</strong> and it‚Äôs <strong>blue</strong>.</p>
<p>That‚Äôs your first observation ‚Äî your first ‚Äúdata point.‚Äù<br>
Now your brain starts guessing:</p>
<blockquote class="blockquote">
<p>‚ÄúHmm‚Ä¶ if there was only 1 blue marble in the bag,<br>
the chance of getting blue was 1 in 4.‚Äù</p>
</blockquote>
<blockquote class="blockquote">
<p>‚ÄúIf there were 3 blue marbles, that would be much more likely.‚Äù</p>
</blockquote>
<p>So you start to <strong>update your belief</strong> about what‚Äôs inside the bag.</p>
</section>
<section id="every-new-draw-creates-a-fork" class="level3">
<h3 class="anchored" data-anchor-id="every-new-draw-creates-a-fork">Every new draw creates a fork</h3>
<p>If you draw again and get another <strong>blue</strong>,<br>
your belief that ‚Äúthe bag has more blue marbles‚Äù gets stronger.</p>
<p>If you then draw a <strong>white</strong>, it bends your belief the other way.</p>
<p>Each draw sends your understanding down a new <strong>branch</strong> in the garden ‚Äî<br>
different outcomes, different paths of belief.</p>
<p>That‚Äôs what McElreath means by <em>the garden of forking data</em>:</p>
<blockquote class="blockquote">
<p>‚ÄúThe data we see could have been different,<br>
and each difference would lead us down a different reasoning path.‚Äù</p>
</blockquote>
</section>
<section id="lets-build-the-garden-of-forking-marbles-in-r" class="level3">
<h3 class="anchored" data-anchor-id="lets-build-the-garden-of-forking-marbles-in-r">Let‚Äôs build the garden of forking marbles in R</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of draws</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n_draws <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all possible outcomes (paths) - each draw can be 0 (white) or 1 (blue)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="fu">replicate</span>(n_draws, <span class="fu">c</span>(<span class="st">"W"</span>, <span class="st">"B"</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(paths) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"draw"</span>, <span class="dv">1</span><span class="sc">:</span>n_draws)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert each combination into a string (e.g., "W-B-B")</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> paths <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path =</span> <span class="fu">apply</span>(., <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">"-"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create edges for the tree structure</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges from root to first draw</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (first_draw <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"W"</span>, <span class="st">"B"</span>)) {</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  edges <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(edges, <span class="fu">tibble</span>(<span class="at">from =</span> <span class="st">"Start"</span>, <span class="at">to =</span> first_draw))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges for subsequent draws</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_draws) {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get all possible prefixes of length i-1</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  prefixes <span class="ot">&lt;-</span> paths <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span>(i<span class="dv">-1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(<span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">"-"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (prefix <span class="cf">in</span> prefixes) {</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges to both possible next draws</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    edges <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(edges, </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tibble</span>(<span class="at">from =</span> prefix, <span class="at">to =</span> <span class="fu">paste</span>(prefix, <span class="st">"W"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)),</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tibble</span>(<span class="at">from =</span> prefix, <span class="at">to =</span> <span class="fu">paste</span>(prefix, <span class="st">"B"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create graph - make sure we have all vertices</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>all_nodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(edges<span class="sc">$</span>from, edges<span class="sc">$</span>to))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(edges, <span class="at">vertices =</span> <span class="fu">data.frame</span>(<span class="at">name =</span> all_nodes), <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add node attributes for better visualization</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g)<span class="sc">$</span>draw_level <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">V</span>(g)<span class="sc">$</span>name, <span class="cf">function</span>(x) {</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="st">"Start"</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">strsplit</span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]])</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g)<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">V</span>(g)<span class="sc">$</span>name, <span class="cf">function</span>(x) {</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="st">"Start"</span>) <span class="fu">return</span>(<span class="st">"gray"</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  draws <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  last_draw <span class="ot">&lt;-</span> <span class="fu">tail</span>(draws, <span class="dv">1</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (last_draw <span class="sc">==</span> <span class="st">"B"</span>) <span class="st">"lightblue"</span> <span class="cf">else</span> <span class="st">"white"</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g)<span class="sc">$</span>border_color <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">V</span>(g)<span class="sc">$</span>name, <span class="cf">function</span>(x) {</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="st">"Start"</span>) <span class="fu">return</span>(<span class="st">"black"</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  draws <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  last_draw <span class="ot">&lt;-</span> <span class="fu">tail</span>(draws, <span class="dv">1</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (last_draw <span class="sc">==</span> <span class="st">"B"</span>) <span class="st">"darkblue"</span> <span class="cf">else</span> <span class="st">"darkgray"</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the "Garden of Forking Data"</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(g, <span class="at">layout =</span> <span class="st">"tree"</span>) <span class="sc">+</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>)), </span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>                 <span class="at">edge_color =</span> <span class="st">"gray"</span>, <span class="at">edge_width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">I</span>(color)), <span class="at">stroke =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"üåø The Garden of Forking Data (3 Marble Draws)"</span>,</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each branch shows a different sequence of marble colors (W=White, B=Blue)"</span>,</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Start ‚Üí First draw ‚Üí Second draw ‚Üí Third draw"</span>) <span class="sc">+</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray40"</span>)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>..</p>
<p>‚Ä¶</p>
</section>
</section>
<section id="building-a-model" class="level2">
<h2 class="anchored" data-anchor-id="building-a-model">2.2 Building a model</h2>
<p>‚Ä¶</p>
</section>
<section id="components-of-the-model" class="level2">
<h2 class="anchored" data-anchor-id="components-of-the-model">2.3 Components of the model</h2>
<p>‚Ä¶</p>
</section>
<section id="making-the-model-go" class="level2">
<h2 class="anchored" data-anchor-id="making-the-model-go">2.4 Making the model go</h2>
<p>‚Ä¶</p>
<p>‚Ä¶</p>
</section>
</section>
<section id="chapter-3---sampling-the-imaginary" class="level1">
<h1>Chapter 3 - Sampling the Imaginary</h1>
<p>‚Ä¶</p>
</section>
<section id="notes-and-references" class="level1">
<h1>Notes and References:</h1>
<ul>
<li><p><a href="https://github.com/rmcelreath/stat_rethinking_2023" class="uri">https://github.com/rmcelreath/stat_rethinking_2023</a></p></li>
<li><p><a href="https://bookdown.org/content/4857/" class="uri">https://bookdown.org/content/4857/</a></p></li>
<li><p><a href="https://psmits.github.io/paleo_book/introduction-to-bayesian-data-analysis.html" class="uri">https://psmits.github.io/paleo_book/introduction-to-bayesian-data-analysis.html</a></p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>